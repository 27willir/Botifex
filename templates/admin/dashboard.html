{% extends "admin/_base_admin.html" %}

{% block title %}Admin Dashboard{% endblock %}
{% block page_title %}Admin Dashboard{% endblock %}
{% block page_subtitle %}System overview and statistics{% endblock %}

{% block extra_styles %}
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 32px;
}

.stat-card {
    background: rgba(26, 26, 46, 0.6);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 191, 255, 0.2);
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, transparent, #00bfff, transparent);
}

.stat-card:hover {
    transform: translateY(-4px);
    border-color: rgba(0, 191, 255, 0.4);
    box-shadow: 0 8px 24px rgba(0, 191, 255, 0.2);
}

.stat-card h3 {
    color: rgba(255, 255, 255, 0.6);
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 12px;
    font-weight: 600;
}

.stat-card .value {
    font-size: 36px;
    font-weight: 800;
    background: linear-gradient(135deg, #00bfff 0%, #007bff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stat-card .icon {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 32px;
    color: rgba(0, 191, 255, 0.2);
}
{% endblock %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card">
        <i class="fas fa-users icon"></i>
        <h3>Total Users</h3>
        <div class="value">{{ stats.total_users }}</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-user-check icon"></i>
        <h3>Active Users</h3>
        <div class="value">{{ stats.active_users }}</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-list icon"></i>
        <h3>Total Listings</h3>
        <div class="value">{{ stats.total_listings }}</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-shield-alt icon"></i>
        <h3>Admin Users</h3>
        <div class="value">{{ stats.admin_users }}</div>
    </div>
    <div class="stat-card">
        <i class="fas fa-database icon"></i>
        <h3>Cache Keys</h3>
        <div class="value">{{ stats.cache_keys }}</div>
    </div>
</div>

<div class="section">
    <h2><i class="fas fa-users"></i> Recent Users</h2>
    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Created</th>
                <th>Last Login</th>
                <th>Login Count</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td><a href="{{ url_for('admin.user_detail', username=user[0]) }}">{{ user[0] }}</a></td>
                <td>{{ user[1] }}</td>
                <td><span class="badge badge-{{ user[4] }}">{{ user[4] }}</span></td>
                <td><span class="badge badge-{% if user[5] %}active{% else %}inactive{% endif %}">{% if user[5] %}Active{% else %}Inactive{% endif %}</span></td>
                <td>{{ user[6] if user[6] else 'N/A' }}</td>
                <td>{{ user[7] if user[7] else 'Never' }}</td>
                <td>{{ user[8] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="section">
    <h2><i class="fas fa-history"></i> Recent Activity</h2>
    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Action</th>
                <th>Details</th>
                <th>IP Address</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody>
            {% for activity in recent_activity[:20] %}
            <tr>
                <td>{{ activity[0] }}</td>
                <td><strong>{{ activity[1] }}</strong></td>
                <td>{{ activity[2] if activity[2] else '-' }}</td>
                <td>{{ activity[3] if activity[3] else '-' }}</td>
                <td>{{ activity[4] if activity[4] else '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="section">
    <h2><i class="fas fa-search"></i> Latest Search Preferences</h2>
    <table>
        <thead>
            <tr>
                <th>User</th>
                <th>Keywords</th>
                <th>Location</th>
                <th>Radius</th>
                <th>Price Range</th>
                <th>Updated</th>
            </tr>
        </thead>
        <tbody>
            {% for pref in search_preferences %}
            <tr>
                <td><a href="{{ url_for('admin.user_detail', username=pref.username) }}">{{ pref.username }}</a></td>
                <td>{{ pref.keywords or '—' }}</td>
                <td>{{ pref.location or '—' }}</td>
                <td>{{ pref.radius or '—' }}</td>
                <td>
                    {% if pref.min_price or pref.max_price %}
                        {{ pref.min_price or '0' }} – {{ pref.max_price or '∞' }}
                    {% else %}
                        —
                    {% endif %}
                </td>
                <td>{{ pref.updated_at or '—' }}</td>
            </tr>
            {% else %}
            <tr><td colspan="6" style="text-align:center;">No search preferences found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="section">
    <h2><i class="fas fa-bookmark"></i> Recent Saved Searches</h2>
    <table>
        <thead>
            <tr>
                <th>User</th>
                <th>Name</th>
                <th>Keywords</th>
                <th>Location</th>
                <th>Radius</th>
                <th>Price Range</th>
                <th>Created</th>
            </tr>
        </thead>
        <tbody>
            {% for search in saved_searches %}
            <tr>
                <td><a href="{{ url_for('admin.user_detail', username=search.username) }}">{{ search.username }}</a></td>
                <td>{{ search.name or '—' }}</td>
                <td>{{ search.keywords or '—' }}</td>
                <td>{{ search.location or '—' }}</td>
                <td>{{ search.radius or '—' }}</td>
                <td>
                    {% if search.min_price or search.max_price %}
                        {{ search.min_price or '0' }} – {{ search.max_price or '∞' }}
                    {% else %}
                        —
                    {% endif %}
                </td>
                <td>{{ search.created_at or '—' }}</td>
            </tr>
            {% else %}
            <tr><td colspan="7" style="text-align:center;">No saved searches found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
