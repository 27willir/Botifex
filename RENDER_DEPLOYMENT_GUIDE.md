# Render Deployment Guide for Super-Bot

This guide will help you deploy Super-Bot to Render.com successfully.

## Prerequisites

1. A Render.com account (free tier works)
2. Your GitHub repository connected to Render
3. Stripe account (for payment processing)
4. SMTP credentials (for email notifications - optional)
5. Twilio credentials (for SMS notifications - optional)

## Quick Deploy Steps

### 1. Push Your Code to GitHub

Make sure all your latest changes are pushed to your GitHub repository:

```bash
git add .
git commit -m "Add Render deployment configuration"
git push origin main
```

### 2. Create New Web Service on Render

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click "New +" and select "Web Service"
3. Connect your GitHub repository
4. Select your `super-bot` repository

### 3. Configure the Web Service

**Basic Settings:**
- **Name**: `super-bot` (or your preferred name)
- **Region**: Choose closest to your users (e.g., Oregon)
- **Branch**: `main`
- **Runtime**: `Python 3`
- **Build Command**: `chmod +x build.sh && ./build.sh`
- **Start Command**: `gunicorn --config gunicorn_config.py app:app`

**Instance Type:**
- Start with **Starter** ($7/month) or **Free** tier
- Can upgrade to Starter+ for better performance

### 4. Environment Variables

Add these environment variables in Render Dashboard:

#### Required Variables (Auto-configured):
These are already set in `render.yaml`:
- `PYTHON_VERSION`: 3.11.9
- `FLASK_ENV`: production
- `FLASK_DEBUG`: False
- `SECRET_KEY`: (Auto-generated by Render)

#### Stripe Configuration (Required for payments):
```
STRIPE_SECRET_KEY=sk_live_your_secret_key_here
STRIPE_PUBLISHABLE_KEY=pk_live_your_publishable_key_here
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here
STRIPE_STANDARD_PRICE_ID=price_standard_subscription_id
STRIPE_PRO_PRICE_ID=price_pro_subscription_id
```

#### Email Notifications (Optional - for email features):
```
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM_EMAIL=your-email@gmail.com
SMTP_FROM_NAME=Super-Bot Alerts
```

#### SMS Notifications (Optional - for Twilio SMS):
```
TWILIO_ACCOUNT_SID=your_account_sid
TWILIO_AUTH_TOKEN=your_auth_token
TWILIO_FROM_NUMBER=+1234567890
```

### 5. Deploy

1. Click "Create Web Service"
2. Render will automatically build and deploy your application
3. Watch the build logs for any errors
4. Once deployed, you'll get a URL like: `https://super-bot.onrender.com`

## Post-Deployment Setup

### 1. Create Admin Account

Once deployed, create your admin account:

```bash
# Connect to Render Shell (from Dashboard > Shell tab)
python scripts/create_admin.py
```

Or create manually through the registration page and update in database.

### 2. Configure Stripe Webhooks

1. Go to [Stripe Dashboard > Webhooks](https://dashboard.stripe.com/webhooks)
2. Click "Add endpoint"
3. Enter your Render URL: `https://your-app.onrender.com/webhook/stripe`
4. Select events:
   - `checkout.session.completed`
   - `customer.subscription.created`
   - `customer.subscription.updated`
   - `customer.subscription.deleted`
5. Copy the webhook signing secret to your Render environment variables

### 3. Set Up Database Persistence (Important!)

Render's free tier filesystem is ephemeral. For production:

**Option 1: Use Render PostgreSQL (Recommended for Production)**
- Add a PostgreSQL database on Render
- Update `db_enhanced.py` to use PostgreSQL instead of SQLite
- Connection URL provided automatically by Render

**Option 2: Use Render Disk (Paid Feature)**
- In Render Dashboard, add a persistent disk
- Mount at `/opt/render/project/src`
- Your SQLite database will persist across deploys

**Option 3: Keep SQLite (Development/Testing Only)**
- Database resets on each deploy
- Good for testing, not for production

### 4. Monitor Your Application

Check the Render Dashboard for:
- **Logs**: View application logs in real-time
- **Metrics**: CPU, memory, and request metrics
- **Health**: Automatic health checks at `/`

## Troubleshooting

### Build Fails

**Error: "Python version not found"**
- Check that `runtime.txt` contains `python-3.11.9`
- Ensure it's in the root directory

**Error: "Failed to install requirements"**
- Check `requirements.txt` for any incompatible packages
- Review build logs for specific package errors

### Deployment Issues

**Error: "Web service failed to start"**
- Check that `gunicorn` is in requirements.txt
- Verify `gunicorn_config.py` exists
- Review logs for Python errors

**Database errors on startup**
- Ensure `build.sh` runs successfully
- Check that `scripts/init_db.py` completes
- Verify database permissions

### Selenium/Scraper Warnings

The Facebook scraper requires Selenium which won't work on Render without additional setup. The app now handles this gracefully:
- Other scrapers (Craigslist, eBay, KSL) will work fine
- Facebook scraper will be disabled automatically
- Users will see a warning if they try to use it

To enable Selenium on Render (Advanced):
1. Add Chrome buildpack in Render settings
2. Install chromium and chromedriver
3. Update scraper to use system chrome

## Scaling for Production

### Performance Optimization

1. **Upgrade Instance Type**
   - Standard: 2x performance of Starter
   - Pro: 4x performance with auto-scaling

2. **Configure Workers**
   - Set `WEB_CONCURRENCY` environment variable
   - Default: 2 workers (good for Starter)
   - Increase for larger instances

3. **Enable Caching**
   - Already configured in the app
   - Uses in-memory cache by default
   - Consider Redis for multi-instance setups

### Database Scaling

For 100+ concurrent users:
- Use PostgreSQL instead of SQLite
- Enable connection pooling (already configured)
- Consider read replicas for heavy read workloads

### Monitoring & Alerts

Set up monitoring for:
- Response times
- Error rates
- Database performance
- Subscription events

## Security Checklist

- [ ] Change `SECRET_KEY` (auto-generated by Render)
- [ ] Use Stripe live keys (not test keys)
- [ ] Enable HTTPS (automatic on Render)
- [ ] Set `SESSION_COOKIE_SECURE=True` (already set)
- [ ] Protect admin routes with strong passwords
- [ ] Enable rate limiting (already configured)
- [ ] Review CORS settings if using external APIs

## Cost Estimate

**Minimal Setup (Testing):**
- Free tier: $0/month (with limitations)
- Database resets on deploy

**Basic Production:**
- Starter instance: $7/month
- PostgreSQL: $7/month
- **Total: $14/month**

**Professional Setup:**
- Standard instance: $25/month
- PostgreSQL Standard: $25/month
- Persistent disk: $0.25/GB/month
- **Total: ~$50-60/month**

## Alternative: Using render.yaml

For automated setup, you can use the included `render.yaml` file:

1. In Render Dashboard, go to "Blueprint"
2. Click "New Blueprint Instance"
3. Connect your repository
4. Render will read `render.yaml` and configure everything automatically
5. You'll still need to add secret environment variables manually

## Support

If you encounter issues:

1. **Check Logs**: Render Dashboard > Logs tab
2. **Review Documentation**: 
   - `STRIPE_SETUP_GUIDE.md` for payment setup
   - `README.md` for general setup
3. **Common Issues**: Check `BUG_SCAN_REPORT.md`
4. **Render Support**: [Render Community](https://community.render.com/)

## Next Steps

After successful deployment:

1. âœ… Test user registration
2. âœ… Test login/logout
3. âœ… Create a test subscription
4. âœ… Test scraper functionality (except Facebook)
5. âœ… Set up Stripe test payment
6. âœ… Configure email/SMS notifications
7. âœ… Monitor for 24 hours to ensure stability

## Maintenance

**Regular Tasks:**
- Monitor error logs weekly
- Review subscription metrics
- Update dependencies monthly
- Backup database regularly (if using SQLite)
- Test payment flow after Stripe updates

**Before Major Updates:**
- Test locally first
- Create database backup
- Deploy during low-traffic hours
- Monitor logs closely after deployment

---

## Quick Reference Commands

```bash
# View logs
render logs

# Access shell
render shell

# Restart service
render restart

# Scale workers
render config set WEB_CONCURRENCY=4
```

Your Super-Bot is now ready for production! ðŸš€

